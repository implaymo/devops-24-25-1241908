 # CA1, Part 3: Technical Report : Converting the basic version of the Tutorial application to Gradle.
---

## Table of Contents

1. [Introduction](#introduction)
2. [Steps to Follow](#steps-to-follow)
    - [Create a New Branch](#1-create-a-new-branch)
    - [Initialize a Gradle Project](#2-initialize-a-gradle-project)
    - [Extract and Set Up the Project](#3-extract-and-set-up-the-project)
    - [Replace Source Code](#4-replace-source-code)
    - [Run the Application](#5-run-the-application)
    - [Add Frontend Support](#6-add-frontend-support)
    - [Configure Webpack Execution in package.json](#7-configure-webpack-execution-in-packagejson)
    - [Build and Run Application](#8-build-and-run-application)
    - [Automate JAR Deployment](#9-automate-jar-deployment)
    - [Clean Generated Frontend Files](#10-clean-generated-frontend-files)
    - [Testing and Finalization](#11-testing-and-finalization)
    - [Tagging the Repository](#12-tagging-the-repository)
3. [Alternative Solution](#alternative-solution)
    - [Analysis of Alternatives](#analysis-of-alternatives)
    - [Maven vs. Gradle](#maven-vs-gradle)
    - [Why Use Gradle?](#why-use-gradle)
    - [Challenges Faced](#challenges-faced)
4. [Conclusion](#conclusion)

---

### Introduction
This guide focuses on practicing Gradle and creating a Spring Boot application. You will set up and modify a Gradle project, add custom tasks, and integrate unit testing. Key tasks include executing the provided application, adding Gradle tasks for running a server, performing backups, and creating a zip archive. Proper version control practices, including multiple commits, tagging, and using issues, are required.

--- 

### Steps to Follow
1. **Create a New Branch:**
    - Name: `tut-basic-gradle`
    - Checkout the branch and use it for all modifications.

2. **Initialize a Gradle Project:**
    - Use [Spring Initializr](https://start.spring.io) to generate a Gradle-based Spring Boot project.
    - Choose the following requirements:
        - Project:
            - Gradle - Groovy
        - Language:
            - Java
        - Spring Boot:
            - 3.4.3
        - Packaging:
            - Jar
        - Java:
            - 17
    - Select dependencies:
        - Rest Repositories
        - Thymeleaf
        - JPA
        - H2

3. **Extract and Set Up the Project:**
    - Extract the generated zip into `CA1/Part3/`.
    - Verify available Gradle tasks using `./gradlew tasks`.

4. **Replace Source Code:**
    - Delete the `src` folder from the new project.
    - Copy `src` from the `basic` folder, `webpack.config.js` and `package.json` of [this](https://github.com/spring-attic/tut-react-and-spring-data-rest) tutorial.
    - Delete `src/main/resources/static/built/` (it will be generated via Webpack).

5. **Run the Application:**
    - Execute `./gradlew bootRun`.
    - Observe that `http://localhost:8080` is empty due to missing frontend plugin.

6. **Add Frontend Support:**
- Include the Gradle plugin: `org.siouan.frontend` ([Plugin Documentation](https://github.com/Siouan/frontend-gradle-plugin)).
- Modify `build.gradle` by adding one of the following lines depending on the Java version:
  ```groovy
  id "org.siouan.frontend-jdk8" version "6.0.0"
  id "org.siouan.frontend-jdk11" version "8.0.0"
  id "org.siouan.frontend-jdk17" version "8.0.0"
  ```
- Configure the plugin in `build.gradle`:
  ```groovy
  frontend {
   nodeVersion = "16.20.2"
   assembleScript = "run build"
   cleanScript = "run clean"
   checkScript = "run check"
   packageJsonDirectory = file("${projectDir}")
  }
  ```

7. **Configure Webpack Execution in `package.json`:**
   ```json
   "scripts": {
    "webpack": "webpack",
    "build": "npm run webpack",
    "check": "echo Checking frontend",
    "clean": "echo Cleaning frontend",
    "lint": "echo Linting frontend",
    "test": "echo Testing frontend"
   },
   ```

8. **Build and Run Application:**
    - Execute `./gradlew build`.
    - Run `./gradlew bootRun`.


9. **Automate Jar Deployment:**
    - Add a Gradle task to copy the generated JAR to a `dist` folder at the root level.
   ```groovy
   tasks.register('copyJarToDist', Copy) {
	dependsOn jar
	from jar.archiveFile
	into "${projectDir}/dist"
	doFirst {
		mkdir "${projectDir}/dist"
    }
   }
   ```

10. **Clean Generated Frontend Files:**
    - Create a Gradle task to remove files generated by Webpack (`src/main/resources/static/built/`) and ensure this task runs before `clean`.
    ```groovy
    tasks.register('cleanWebpack', Delete) {
	group = 'build'
	description = 'Deletes all files generated by webpack'
	delete "${projectDir}/src/main/resources/static/built/"
	doFirst {
		println "Cleaning webpack output directory at: ${projectDir}/src/resources/main/static/built/"
        }
    }
    
    tasks.named('clean') {
    dependsOn('cleanWebpack')
    }
    ```

11. **Testing and Finalization:**
    - Experiment with the application and validate all features.
    - Commit changes incrementally.
    - Merge the `tut-basic-gradle` branch into `main`.

13. **Tagging the Repository:**
    - Mark the repository with the tag `ca1-part3` upon completion.
    ```sh
    git tag ca1-part3
    git push origin ca1-part3
    ```
---
## Alternative Solution

### Step-by-Step Guide: Migrating from Gradle to Ant

This guide outlines the process of converting a Spring Boot project from Gradle to Ant, using Apache Ivy for dependency management. The provided `build.xml` and `ivy.xml` files serve as the foundation for this migration.

### Step 1: Install Apache Ant
- Download and install Apache Ant.
- If you're using Windows, set up the ANT_HOME environment variable to point to the Ant installation directory. Then, add the bin folder inside ANT_HOME to your system's PATH variable to enable Ant commands in the terminal.
- On macOS and Linux, you can install Ant using a package manager such as Homebrew (brew install ant) or APT (sudo apt install ant).
### Step 2: Install Apache Ivy
Install Apache Ivy and move the .jar file to Apache Ant "lib" folder.

### Step 3: Set Up the Project Structure
Ensure that your project follows a standard structure compatible with Ant:

```
myapp/
├── src/
│   ├── main/
│   │   ├── java/         # Application source code
│   │   ├── resources/    # Configuration and static files
│   ├── test/            # Unit tests
├── build/               # Compiled output
├── dist/                # Packaged JAR output
├── antlib/              # Manual Spring Boot dependencies
├── lib/                 # Dependencies
├── build.xml            # Ant build script
├── ivy.xml              # Dependency management
├── ivysettings.xml      # Ivy repository configuration
```

### Step 2: Configure Dependency Management with Ivy
Use `ivy.xml` to define dependencies and `ivysettings.xml` to specify the repository resolver:

1. **Define dependencies in `ivy.xml`**:
   ```xml
   <ivy-module version="2.0">
       <info organisation="com.greglturnquist" module="react-and-spring-data-rest-basic-ant" revision="0.0.1-SNAPSHOT" status="integration"/>
       <configurations defaultconf="compile,runtime">
           <conf name="compile" description="Compile dependencies"/>
           <conf name="runtime" description="Runtime dependencies"/>
           <conf name="testCompile" extends="compile" description="Test compile dependencies"/>
           <conf name="testRuntime" extends="runtime,testCompile" description="Test runtime dependencies"/>
           <conf name="developmentOnly" description="Development-only dependencies"/>
       </configurations>
       <dependencies>
           <dependency org="org.springframework.boot" name="spring-boot-starter" rev="3.4.3"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-data-jpa" rev="3.4.3" conf="compile->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-data-rest" rev="3.4.3" conf="compile->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-thymeleaf" rev="3.4.3" conf="compile->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-web" rev="3.4.3" conf="compile->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-jdbc" rev="3.4.3" conf="compile->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-devtools" rev="3.4.3" conf="developmentOnly->default"/>
           <dependency org="com.h2database" name="h2" rev="2.2.224" conf="runtime->default"/>
           <dependency org="org.springframework.boot" name="spring-boot-starter-test" rev="3.4.3" conf="testCompile->default"/>
           <dependency org="org.junit.platform" name="junit-platform-launcher" rev="1.10.0" conf="testRuntime->default"/>
           <dependency org="org.springframework" name="spring-beans" rev="6.2.3"/>
           <dependency org="org.springframework" name="spring-context" rev="6.2.3"/>
       </dependencies>
   </ivy-module>
   ```

2. Create antlib folder and **add specific Spring Boot dependencies** to it:

- Go to Maven Repository and download **.jar** files from the following dependencies:
    - spring-boot-antlib-3.4.3.jar
    - spring-boot-loader-tools-3.4.3.jar
    - spring-core-6.2.3.jar


3. **Configure the Ivy resolver in `ivysettings.xml`**:
   ```xml
   <ivysettings>
       <settings defaultResolver="central"/>
       <resolvers>
           <ibiblio name="central" m2compatible="true"/>
       </resolvers>
   </ivysettings>
   ```

### Step 3: Define Build Tasks in `build.xml`
Ant tasks are specified in `build.xml`.

**Create a build.xml** file with the following code:

```xml
<project
        xmlns:ivy="antlib:org.apache.ivy.ant"
        xmlns:spring-boot="antlib:org.springframework.boot.ant"
        name="myapp" default="build">

    <!-- Define properties -->
    <property name="build.dir" location="build/classes"/>
    <property name="dist.dir" location="dist"/>
    <property name="projectName" value="myapp"/>
    <property name="main-class" value="com.greglturnquist.payroll"/>

    <!-- Debug step: List all files in antlib directory -->
    <target name="debug">
        <echo message="Listing JAR files in antlib directory:"/>
        <pathconvert pathsep="${line.separator}    " property="antlib.jars">
            <fileset dir="antlib" includes="*.jar"/>
        </pathconvert>
        <echo message="    ${antlib.jars}"/>
    </target>

    <target name="copy-resources" depends="init">
        <echo message="Copying resources to build/classes" />
        <copy todir="build/classes">
            <fileset dir="src/main/resources">
                <include name="**/*"/>
            </fileset>
        </copy>
    </target>

    <target name="jar" depends="compile, copy-resources" description="Package output into JAR">
        <mkdir dir="${dist.dir}" />
        <jar jarfile="${dist.dir}/${projectName}.jar" basedir="${build.dir}">
            <manifest>
                <attribute name="Main-Class" value="${main-class}" />
            </manifest>
        </jar>
    </target>

    <path id="antlib.classpath">
        <fileset dir="antlib" includes="*.jar"/>
    </path>

    <!-- Define ivy tasks -->
    <target name="resolve" description="--> retrieve dependencies with ivy">
        <ivy:retrieve pattern="lib/[artifact]-[revision].[ext]" />
    </target>

    <target name="classpaths" depends="resolve">
        <path id="compile.classpath">
            <fileset dir="lib" includes="*.jar" />
        </path>
    </target>

    <target name="init" depends="classpaths">
        <mkdir dir="build/classes" />
    </target>

    <target name="compile" depends="init" description="compile">
        <javac srcdir="src/main/java" destdir="build/classes" classpathref="compile.classpath" />
    </target>

    <!-- Define Spring Boot tasks with explicit loader tools -->
    <target name="define-spring-boot-tasks" depends="classpaths">
        <taskdef uri="antlib:org.springframework.boot.ant"
                 resource="org/springframework/boot/ant/antlib.xml">
            <classpath>
                <fileset dir="antlib" includes="*.jar"/>
                <fileset dir="lib" includes="spring-boot-loader-tools-*.jar"/>
                <path refid="compile.classpath"/>
            </classpath>
        </taskdef>
    </target>

    <target name="build" depends="compile,copy-resources,define-spring-boot-tasks">
        <spring-boot:exejar destfile="build/myapp.jar" classes="build/classes">
            <spring-boot:lib>
                <fileset dir="lib" />
            </spring-boot:lib>
        </spring-boot:exejar>
    </target>

    <target name="run" depends="build">
        <java jar="build/myapp.jar" fork="true">
            <arg line="--spring.profiles.active=dev"/>
        </java>
    </target>

    <target name="createDistDir">
        <mkdir dir="${dist.dir}"/>
    </target>

    <target name="copyJarToDist" depends="jar, createDistDir">
        <copy file="${dist.dir}/${projectName}.jar" todir="${dist.dir}"/>
    </target>

</project>
```

### Step 4: Execute the Ant Build
To build and run the project, execute the following commands:

```sh
ant resolve    # Download dependencies
ant jar        # Compile and package the application
ant run        # Run the application
```
### Step 4: Execute Copy task
To execute copy task just like in Gradle, execute the following command:
```sh
ant copyJarToDist
```

### Comparison: Gradle vs. Ant

| Feature                | Gradle                                        | Ant                                  |
|------------------------|-----------------------------------------------|--------------------------------------|
| Build Script Language | Groovy/Kotlin (Declarative)                   | XML (Imperative)                     |
| Dependency Management | Built-in via Maven Central/Repositories       | Apache Ivy (Separate Configuration) |
| Performance           | Faster (Incremental Builds, Parallel Execution) | Slower (Executes Every Task Fully)  |
| Plugin Support        | Extensive (Plugins for Various Tasks)         | Limited (Requires Manual Configuration) |
| Learning Curve        | Moderate (DSL-Based, More Concise)            | Steeper (XML-Based, Verbose)        |
| Build Flexibility     | Highly Flexible (Task Graphs, Lazy Execution) | Less Flexible (Strict Task Execution Order) |
| Built-in Support for Spring Boot | Yes (Spring Boot Plugin)           | No (Requires Manual Configuration) |
| Community Support     | Large and Active                              | Smaller but Still Maintained        |

Ant, while a more traditional build tool, offered a functional pathway to replicate the build process initially established with Gradle for our Spring Boot project. The process of converting Gradle's dynamic configurations to Ant's explicit XML structure highlighted Ant's capacity for precise build definition and control. Although requiring more manual configuration and verbose scripting compared to Gradle, Ant's inherent simplicity and direct execution model allowed for a clear understanding of each build step. Despite the absence of Gradle's sophisticated dependency resolution and performance enhancements, such as incremental compilation, Ant's proven reliability and cross-platform compatibility demonstrated its enduring relevance in scenarios prioritizing straightforward, explicit build management

---

# Conclusion

Switching from Maven to Gradle enhanced build automation, streamlined dependency management, and improved flexibility. Gradle’s scripting capabilities and frontend integration simplified the workflow, making it a strong choice for modern development. This experience reinforced the importance of selecting the right build tool based on project needs and team expertise.



